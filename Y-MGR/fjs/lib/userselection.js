Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.util=function(){return{PREFIX_ICON:"/part/userselection/icon/",getDisplayText:function(c,a){if(c.text){a=c.type;c=c.text}var b="{0}";if(a=="U"){b="{0}"}else{if(a=="W"){b="<{0}>"}else{if(a=="J"){b="({0})"}else{if(a=="D"){b="[{0}]"}else{if(a=="O"){b="{{0}}"}else{if(a=="F"){b="|{0}|"}}}}}}return String.format(b,c)},getHiddenValue:function(b){var a=b.type+"[{0}]<{1}>";return String.format(a,b.value,b.text)}}}();Ext.part.form.userselection.ValueObj=Ext.extend(Ext.util.Observable,{text:"",value:"",type:""});Ext.part.form.userselection.ValueObjArray=Ext.extend(Ext.util.Observable,{array:null,constructor:function(c){this.array=new Array();if(!Ext.isEmpty(c)&&Ext.type(c)=="string"){var b=c.split(">");for(var d=0;d<b.length;d++){var a=b[d].split("]<");var f=a[0].split("[");if(Ext.isEmpty(f[0])){continue}var e=new Ext.part.form.userselection.ValueObj();e.text=a[1];e.value=f[1];e.type=f[0];this.add(e)}}},remove:function(b){for(var a=0;a<this.array.length;a++){if(b.type==this.array[a].type&&b.value==this.array[a].value){this.array.remove(this.array[a]);return}}},add:function(a){this.remove(a);this.array.push(a)},clear:function(a){this.array=new Array()},getDisplayText:function(){var c="";var a=this.array.length;for(var b=0;b<a;b++){c+=Ext.part.form.userselection.util.getDisplayText(this.array[b]);if(b<a-1){c+=";"}}return c},getHiddenValue:function(){var b="";var a=this.array.length;for(var c=0;c<a;c++){b+=Ext.part.form.userselection.util.getHiddenValue(this.array[c])}return b},getSingleId:function(){if(this.array==null){return""}var a=this.array.length;if(a!=1){return""}return this.array[0].value}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.BaseSelectWindow=Ext.extend(Ext.Window,{selectedValue:null,constructor:function(a){Ext.apply(this,a);Ext.part.form.userselection.BaseSelectWindow.superclass.constructor.call(this,{})},initComponent:function(){this.addEvents("submit");Ext.part.form.userselection.BaseSelectWindow.superclass.initComponent.call(this)},setSelectedValue:function(a){this.selectedValue=a}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.BaseSelectPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.addEvents("loaddata","select","deselect");Ext.part.form.userselection.BaseSelectPanel.superclass.initComponent.call(this)},initSelected:function(a){alert("Panel "+this.title+" must be override this function: initSelected(array)")}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.AccordionTreePanel=Ext.extend(Ext.tree.TreePanel,{constructor:function(a){Ext.apply(this,a);if(Ext.isEmpty(this.dataUrl)){alert("Ext.part.form.userselection.AccordionTreePanel:url can't be empty!");return}Ext.part.form.userselection.AccordionTreePanel.superclass.constructor.call(this,{icon:this.icon||"",title:this.title||"",useArrows:true,autoScroll:true,animate:true,border:false,containerScroll:true,loader:new Ext.tree.TreeLoader({url:this.dataUrl}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false})},initComponent:function(){this.on("click",this.evt_clickNode,this);this.addEvents("queryuser");Ext.part.form.userselection.AccordionTreePanel.superclass.initComponent.call(this)},evt_clickNode:function(a,b){this.fireEvent("queryuser",this.getParams(a),b)},getParams:function(a){var b={};Ext.parf.setProperty(b,this.userParaName,a.id);return b}});Ext.part.form.userselection.JobTitleAccordionTreePanel=Ext.extend(Ext.part.form.userselection.AccordionTreePanel,{constructor:function(){Ext.part.form.userselection.JobTitleAccordionTreePanel.superclass.constructor.call(this,{title:"按职务",dataUrl:"/part/userselection.json?actionName=getJobTitleTreeList"})},getParams:function(a){var b={QUERYBY:"J"};Ext.parf.setProperty(b,"JOBTITLEID",a.id);return b}});Ext.part.form.userselection.DeptAccordionTreePanel=Ext.extend(Ext.part.form.userselection.AccordionTreePanel,{constructor:function(){Ext.part.form.userselection.DeptAccordionTreePanel.superclass.constructor.call(this,{title:"按部门",dataUrl:"/part/userselection.json?actionName=getDeptTreeList"})},getParams:function(a){var b={QUERYBY:"D"};Ext.parf.setProperty(b,"DEPTID",a.id);return b}});Ext.part.form.userselection.WorkGroupAccordionTreePanel=Ext.extend(Ext.part.form.userselection.AccordionTreePanel,{constructor:function(){Ext.part.form.userselection.WorkGroupAccordionTreePanel.superclass.constructor.call(this,{title:"按项目",dataUrl:"/part/userselection.json?actionName=getWorkGroupTreeList"})},getParams:function(a){var b={QUERYBY:"W"};Ext.parf.setProperty(b,"WORKGROUPID",a.id);return b}});Ext.part.form.userselection.OrgAccordionTreePanel=Ext.extend(Ext.part.form.userselection.AccordionTreePanel,{constructor:function(){Ext.part.form.userselection.OrgAccordionTreePanel.superclass.constructor.call(this,{title:"按组织机构",dataUrl:"/part/userselection.json?actionName=getOrgTreeList"})},getParams:function(a){var b={QUERYBY:"O"};Ext.parf.setProperty(b,"ORGID",a.id);return b}});Ext.part.form.userselection.RelationAccordionTreePanel=Ext.extend(Ext.part.form.userselection.AccordionTreePanel,{constructor:function(){Ext.part.form.userselection.OrgAccordionTreePanel.superclass.constructor.call(this,{title:"按关联用户",dataUrl:"/part/userselection.json?actionName=getRelationTreeList"})},getParams:function(c){var a={QUERYBY:"RE"};Ext.parf.setProperty(a,"RTYPE",c.id);return a}});Ext.part.form.userselection.UserGridPanelToolBar=Ext.extend(Ext.Toolbar,{textfiled:null,constructor:function(){this.textfiled=new Ext.form.TextField({name:"USERNAME",maxLength:20,emptyText:"按姓名查询",enableKeyEvents:true});Ext.part.form.userselection.UserGridPanelToolBar.superclass.constructor.call(this,{buttonAlign:"right",items:[this.textfiled,{xtype:"tbspacer",width:5},{iconCls:"btn-search",tooltip:"查询",handler:this.searchUser,scope:this},{xtype:"tbspacer",width:5}]})},initComponent:function(){this.addEvents("queryuser");this.textfiled.on("keydown",function(a,b){if(b.getKey()==Ext.EventObject.ENTER){this.searchUser(a,b)}},this);Ext.part.form.userselection.UserGridPanelToolBar.superclass.initComponent.call(this)},searchUser:function(b,a){this.fireEvent("queryuser",this.getParams(),a)},getParams:function(){var a={};Ext.parf.setProperty(a,this.textfiled.getName(),this.textfiled.getValue());return a}});Ext.part.form.userselection.UserGridPanel=Ext.extend(Ext.grid.GridPanel,{single:true,userStore:null,constructor:function(b){this.single=b.single;delete b;this.userStore=new Ext.parf.data.PageStore({url:"/part/userselection.json",baseParams:{actionName:"getUserPP"},fields:["UMUSERID","USERNAME","DEPTID","DEPTNAME","JOBTITLEID","JOBTITLENAME"],idProperty:"UMUSERID"});var c=new Ext.grid.CheckboxSelectionModel({singleSelect:this.single});var a=new Ext.grid.ColumnModel([c,new Ext.grid.RowNumber(),{header:"姓名",dataIndex:"USERNAME",sortable:false,fixed:true,width:125,hideable:false,menuDisabled:true,renderer:function(h,e,d,i,g,f){e.attr="ext:qtip ='"+d.get("JOBTITLENAME")+"'";return"<span>"+h+"</span>"}},{header:"部门",dataIndex:"DEPTNAME",sortable:false,fixed:true,width:130,hideable:false,menuDisabled:true}]);Ext.part.form.userselection.UserGridPanel.superclass.constructor.call(this,{stripeRows:true,loadMask:true,boldHeader:true,region:"center",margins:"0 1 1 0",store:this.userStore,sm:this.singelSelect?null:c,columnLines:true,cm:a,bbar:Ext.parf.createPageToolBar({store:this.userStore,displayMsg:"共<b>{2}</b>条记录",pageSize:100,plugins:null}),tbar:new Ext.part.form.userselection.UserGridPanelToolBar(),viewConfig:{forceFit:true}})},initComponent:function(){this.tbar.on("queryuser",function(a){this.loadUser(a)},this);Ext.part.form.userselection.UserGridPanel.superclass.initComponent.call(this)},reloadUser:function(){this.getBottomToolbar().doRefresh()},loadUser:function(a){this.store.baseParams={actionName:"getUserPP"};for(p in a){this.store.setBaseParam(p,a[p])}this.getStore().load({params:{start:0,limit:100}})},initSelected:function(a){this.getSelectionModel().clearSelections();for(var b=0;b<a.length;b++){if(a[b].type!="U"){continue}var c=this.getStore().getById(a[b].value);if(!Ext.isEmpty(c)){this.getSelectionModel().selectRow(this.getStore().indexOf(c),true)}}}});Ext.part.form.userselection.UserPanel=Ext.extend(Ext.part.form.userselection.BaseSelectPanel,{queryTreePanel:null,gridPanel:null,dataloaded:false,fireSelect:false,constructor:function(b){this.dataloaded=false;this.fireSelect=false;var d=Ext.apply({single:false},b.grid);var c=[];c.push(new Ext.part.form.userselection.JobTitleAccordionTreePanel());c.push(new Ext.part.form.userselection.DeptAccordionTreePanel());if("W5"==Ext.part.SysParameter.SYSTEM_EDITION){c.push(new Ext.part.form.userselection.WorkGroupAccordionTreePanel())}c.push(new Ext.part.form.userselection.OrgAccordionTreePanel());c.push(new Ext.part.form.userselection.RelationAccordionTreePanel());var a=Ext.apply({region:"west",split:true,collapsible:false,width:200,minSize:100,maxSize:300,margins:"0 0 1 0",layout:"accordion",items:c},b.queryTree);this.gridPanel=new Ext.part.form.userselection.UserGridPanel(d);this.queryTreePanel=new Ext.Panel(a);var e=Ext.apply({panelType:"U",layout:"border",region:"center",border:false,items:[this.queryTreePanel,this.gridPanel]},b);delete b;Ext.part.form.userselection.UserPanel.superclass.constructor.call(this,e)},initComponent:function(){this.addEvents("loaddata","select","deselect");this.gridPanel.getStore().on("beforeload",function(){this.fireSelect=false},this);this.gridPanel.getStore().on("load",function(){this.fireEvent("loaddata",this);this.dataloaded=true},this);this.queryTreePanel.items.each(function(a){a.on("queryuser",function(b,c){this.gridPanel.loadUser(b)},this)},this);this.gridPanel.getSelectionModel().on("rowdeselect",function(c,a,b){if(this.fireSelect){this.fireEvent("deselect",this.getValueObj(b))}},this);this.gridPanel.getSelectionModel().on("rowselect",function(c,a,b){if(this.fireSelect){this.fireEvent("select",this.getValueObj(b))}},this);Ext.part.form.userselection.UserPanel.superclass.initComponent.call(this)},initSelected:function(a){if(!this.dataloaded){this.gridPanel.reloadUser();return}this.fireSelect=false;this.gridPanel.initSelected(a);this.fireSelect=true},getValueObj:function(a){var b=new Ext.part.form.userselection.ValueObj();b.text=a.get("USERNAME");b.value=a.get("UMUSERID");b.type="U";return b}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.OrgPanel=Ext.extend(Ext.part.form.userselection.BaseSelectPanel,{treePanel:null,fireSelect:true,constructor:function(){this.treePanel=new Ext.tree.TreePanel({useArrows:true,autoScroll:true,animate:true,border:false,containerScroll:true,loader:new Ext.tree.TreeLoader({url:"/part/userselection.json?actionName=getOrgCheckTreeList"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false});this.toolbar=new Ext.Toolbar({buttonAlign:"right",items:[{iconCls:"btn-accept1",text:"反选",tooltip:"反向选中组织机构",handler:this.inverseSelect,scope:this},{xtype:"tbspacer",width:5},{iconCls:"btn-delete1",text:"清除",tooltip:"清除选中的组织机构",handler:this.cleanSelect,scope:this}]});Ext.part.form.userselection.OrgPanel.superclass.constructor.call(this,{title:"组织机构",panelType:"O",margins:"1 1 1 1",border:false,bbar:this.toolbar,autoScroll:true,items:[this.treePanel]})},initComponent:function(){this.treePanel.on("checkchange",function(b,a){if(this.fireSelect){if(a){this.fireEvent("select",this.getValueObj(b))}else{this.fireEvent("deselect",this.getValueObj(b))}}},this);this.treePanel.on("load",function(){this.fireEvent("loaddata",this)},this);Ext.part.form.userselection.OrgPanel.superclass.initComponent.call(this)},initSelected:function(b){this.fireSelect=false;var a=function(){this.getUI().toggleCheck(false);this.attributes.checked=false;for(var c=0;c<b.length;c++){var d=b[c];if(d.type!="O"){continue}if(d.value==this.id){this.getUI().toggleCheck(true);this.attributes.checked=true}}};this.treePanel.getRootNode().cascade(a);this.fireSelect=true},cleanSelect:function(){var b=this.treePanel.getChecked();for(var a=0;a<b.length;a++){b[a].getUI().toggleCheck(false);b[a].attributes.checked=false}},inverseSelect:function(){var a=function(){var b=!this.attributes.checked;this.getUI().toggleCheck(b);this.attributes.checked=b};this.treePanel.getRootNode().cascade(a)},getValueObj:function(a){var b=new Ext.part.form.userselection.ValueObj();b.text=a.text;b.value=a.id;b.type="O";return b}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.DeptPanel=Ext.extend(Ext.part.form.userselection.BaseSelectPanel,{checkGroup:null,dataloaded:false,fireSelect:false,constructor:function(){this.dataloaded=false;this.checkGroup=new Ext.parf.form.StoreCheckboxGroup({storeurl:"/part/userselection.json",storeParams:{actionName:"getDeptList"},valueField:"UMDEPTID",displayField:"DEPTNAME",hasAllButton:false,style:"padding:10px;",width:600,groupcfg:{columns:3,allowBlank:true}});this.toolbar=new Ext.Toolbar({buttonAlign:"right",items:[{xtype:"tbspacer",width:5},{iconCls:"btn-accept1",text:"反选",tooltip:"反向选中部门",handler:this.inverseSelect,scope:this},{xtype:"tbspacer",width:5},{iconCls:"btn-delete1",text:"清除",tooltip:"清除选中的部门",handler:this.cleanSelect,scope:this}]});Ext.part.form.userselection.DeptPanel.superclass.constructor.call(this,{title:"部门",panelType:"D",cls:"x-panel-mc",margins:"1 1 1 1",bbar:this.toolbar,items:[this.checkGroup]})},initComponent:function(){this.checkGroup.groupbox.on("afterrender",function(){this.fireSelect=true;this.checkGroup.groupbox.items.each(function(a){a.on("check",function(c,b){if(this.fireSelect){if(b){this.fireEvent("select",this.getValueObj(c))}else{this.fireEvent("deselect",this.getValueObj(c))}}},this)},this)},this);Ext.part.form.userselection.DeptPanel.superclass.initComponent.call(this)},initSelected:function(e){this.fireSelect=false;var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){if(a[b].setValue){a[b].setValue(false)}else{a[b].checked=false}for(var c=0;c<e.length;c++){var d=e[c];if(d.type!="D"){continue}if(a[b].inputValue==d.value){if(a[b].setValue){a[b].setValue(true)}else{a[b].checked=true}break}}}this.fireSelect=true},getValueObj:function(a){var b=new Ext.part.form.userselection.ValueObj();b.text=a.boxLabel;b.value=a.inputValue;b.type="D";return b},cleanSelect:function(){var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){a[b].setValue(false)}},inverseSelect:function(){var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){a[b].setValue(!a[b].getValue())}}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.JobTitlePanel=Ext.extend(Ext.part.form.userselection.BaseSelectPanel,{treePanel:null,fireSelect:true,constructor:function(){this.treePanel=new Ext.tree.TreePanel({useArrows:true,autoScroll:true,animate:true,border:false,containerScroll:true,loader:new Ext.tree.TreeLoader({url:"/part/userselection.json?actionName=getJobTitleCheckTreeList"}),root:new Ext.tree.AsyncTreeNode({expanded:true}),rootVisible:false});this.toolbar=new Ext.Toolbar({buttonAlign:"right",items:[{iconCls:"btn-accept1",text:"反选",tooltip:"反向选中职位",handler:this.inverseSelect,scope:this},{xtype:"tbspacer",width:5},{iconCls:"btn-delete1",text:"清除",tooltip:"清除选中的职位",handler:this.cleanSelect,scope:this}]});Ext.part.form.userselection.JobTitlePanel.superclass.constructor.call(this,{title:"职位",panelType:"J",margins:"1 1 1 1",bbar:this.toolbar,autoScroll:true,items:[this.treePanel]})},initComponent:function(){this.treePanel.on("checkchange",function(b,a){if(this.fireSelect){if(a){this.fireEvent("select",this.getValueObj(b))}else{this.fireEvent("deselect",this.getValueObj(b))}}},this);this.treePanel.on("load",function(){this.fireEvent("loaddata",this)},this);Ext.part.form.userselection.JobTitlePanel.superclass.initComponent.call(this)},initSelected:function(b){this.fireSelect=false;var a=function(){this.getUI().toggleCheck(false);this.attributes.checked=false;for(var c=0;c<b.length;c++){var d=b[c];if(d.type!="J"){continue}if(d.value==this.id){this.getUI().toggleCheck(true);this.attributes.checked=true}}};this.treePanel.getRootNode().cascade(a);this.fireSelect=true},cleanSelect:function(){var b=this.treePanel.getChecked();for(var a=0;a<b.length;a++){b[a].getUI().toggleCheck(false);b[a].attributes.checked=false}},inverseSelect:function(){var a=function(){var b=!this.attributes.checked;this.getUI().toggleCheck(b);this.attributes.checked=b};this.treePanel.getRootNode().cascade(a)},getValueObj:function(a){var b=new Ext.part.form.userselection.ValueObj();b.text=a.text;b.value=a.id;b.type="J";return b}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.RelationPanel=Ext.extend(Ext.part.form.userselection.BaseSelectPanel,{checkGroup:null,dataloaded:false,fireSelect:false,constructor:function(){this.dataloaded=false;this.checkGroup=new Ext.parf.form.StoreCheckboxGroup({storeurl:"/part/userselection.json",storeParams:{actionName:"getRelationList"},valueField:"REFERENCEID",displayField:"REFERENCEVALUE",hasAllButton:false,style:"padding:10px;",width:600,groupcfg:{columns:3,allowBlank:true}});this.toolbar=new Ext.Toolbar({buttonAlign:"right",items:[{xtype:"tbspacer",width:5},{iconCls:"btn-accept1",text:"反选",tooltip:"反向选中部门",handler:this.inverseSelect,scope:this},{xtype:"tbspacer",width:5},{iconCls:"btn-delete1",text:"清除",tooltip:"清除选中的部门",handler:this.cleanSelect,scope:this}]});Ext.part.form.userselection.RelationPanel.superclass.constructor.call(this,{title:"关联用户",panelType:"RE",cls:"x-panel-mc",margins:"1 1 1 1",bbar:this.toolbar,items:[this.checkGroup]})},initComponent:function(){this.checkGroup.groupbox.on("afterrender",function(){this.fireSelect=true;this.checkGroup.groupbox.items.each(function(a){a.on("check",function(c,b){if(this.fireSelect){if(b){this.fireEvent("select",this.getValueObj(c))}else{this.fireEvent("deselect",this.getValueObj(c))}}},this)},this)},this);Ext.part.form.userselection.RelationPanel.superclass.initComponent.call(this)},initSelected:function(e){this.fireSelect=false;var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){if(a[b].setValue){a[b].setValue(false)}else{a[b].checked=false}for(var c=0;c<e.length;c++){var d=e[c];if(d.type!="RE"){continue}if(a[b].inputValue==d.value){if(a[b].setValue){a[b].setValue(true)}else{a[b].checked=true}break}}}this.fireSelect=true},getValueObj:function(a){var b=new Ext.part.form.userselection.ValueObj();b.text=a.boxLabel;b.value=a.inputValue;b.type="RE";return b},cleanSelect:function(){var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){a[b].setValue(false)}},inverseSelect:function(){var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){a[b].setValue(!a[b].getValue())}}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.WorkGroupPanel=Ext.extend(Ext.part.form.userselection.BaseSelectPanel,{checkGroup:null,dataloaded:false,fireSelect:false,constructor:function(){this.dataloaded=false;this.checkGroup=new Ext.parf.form.StoreCheckboxGroup({storeurl:"/part/userselection.json",storeParams:{actionName:"getWorkGroupList"},valueField:"WORKGROUPID",displayField:"WORKGROUPNAME",hasAllButton:false,style:"padding:10px;",width:600,groupcfg:{columns:3,allowBlank:true}});this.toolbar=new Ext.Toolbar({buttonAlign:"right",items:[{xtype:"tbspacer",width:5},{iconCls:"btn-accept1",text:"反选",tooltip:"反向选中项目",handler:this.inverseSelect,scope:this},{xtype:"tbspacer",width:5},{iconCls:"btn-delete1",text:"清除",tooltip:"清除选中的项目",handler:this.cleanSelect,scope:this}]});Ext.part.form.userselection.WorkGroupPanel.superclass.constructor.call(this,{title:"项目",panelType:"W",cls:"x-panel-mc",margins:"1 1 1 1",bbar:this.toolbar,items:[this.checkGroup]})},initComponent:function(){Ext.part.form.userselection.WorkGroupPanel.superclass.initComponent.call(this);this.checkGroup.groupbox.on("afterrender",function(){this.fireSelect=true;this.checkGroup.groupbox.items.each(function(a){a.on("check",function(c,b){if(this.fireSelect){if(b){this.fireEvent("select",this.getValueObj(c))}else{this.fireEvent("deselect",this.getValueObj(c))}}},this)},this)},this)},initSelected:function(e){this.fireSelect=false;var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){if(a[b].setValue){a[b].setValue(false)}else{a[b].checked=false}for(var c=0;c<e.length;c++){var d=e[c];if(d.type!="W"){continue}if(a[b].inputValue==d.value){if(a[b].setValue){a[b].setValue(true)}else{a[b].checked=true}break}}}this.fireSelect=true},getValueObj:function(a){var b=new Ext.part.form.userselection.ValueObj();b.text=a.boxLabel;b.value=a.inputValue;b.type="W";return b},cleanSelect:function(){var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){a[b].setValue(false)}},inverseSelect:function(){var a=this.checkGroup.groupbox.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){a[b].setValue(!a[b].getValue())}}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.SelectedPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(b){this.store=new Ext.data.JsonStore({root:"data",fields:["text","type","value"],idProperty:"value"});this.toolbar=new Ext.Toolbar({buttonAlign:"right",items:[{xtype:"tbspacer",width:5},{iconCls:"btn-delete1",text:"清除",tooltip:"清除选中的角色",handler:this.cleanSelect,scope:this}]});var c=new Ext.grid.CheckboxSelectionModel();var a=new Ext.grid.ColumnModel([c,new Ext.grid.RowNumber(),{header:"",dataIndex:"type",renderer:function(d){return"<img width='16' heigth='16' src='"+Ext.part.form.userselection.util.PREFIX_ICON+d+".gif'/>"},width:25,sortable:true,resizable:false,menuDisabled:true},{header:"值",dataIndex:"text",renderer:function(h,g,d,i,f,e){return Ext.part.form.userselection.util.getDisplayText(d.get("text"),d.get("type"))},sortable:true,hideable:false,menuDisabled:true}]);Ext.part.form.userselection.UserGridPanel.superclass.constructor.call(this,{title:"已选列表",stripeRows:true,boldHeader:true,region:"east",margins:"0 1 1 4",width:200,store:this.store,sm:c,columnLines:true,cm:a,bbar:this.toolbar,viewConfig:{forceFit:true}})},initComponent:function(){this.addEvents("remove");Ext.part.form.userselection.UserGridPanel.superclass.initComponent.call(this)},init:function(a){this.getStore().loadData({data:a})},cleanSelect:function(){var e=this.getSelectionModel();if(!e.hasSelection()){Ext.parf.showInfo("请先选择要清除的值！");return}var a=e.getSelections();var d=new Array();for(var b=0;b<a.length;b++){var c=new Ext.part.form.userselection.ValueObj();c.type=a[b].get("type");c.value=a[b].get("value");c.text=a[b].get("text");d.push(c)}this.fireEvent("remove",d)}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.SingelUserSelectWindow=Ext.extend(Ext.part.form.userselection.BaseSelectWindow,{userPanel:null,selectedValue:null,constructor:function(){this.userPanel=new Ext.part.form.userselection.UserPanel({grid:{single:true}});Ext.part.form.userselection.SingelUserSelectWindow.superclass.constructor.call(this,{title:"人员选择",icon:"",layout:"fit",width:600,height:400,buttonAlign:"center",closeAction:"hide",plain:true,modal:true,resizable:false,items:[{layout:"fit",border:false,items:[this.userPanel]}],buttons:[{text:"确定",iconCls:"btn-accept",handler:this.submit_onclick,scope:this},{text:"取消",iconCls:"btn-stop",handler:this.cancle_onclick,scope:this}]})},initComponent:function(){this.userPanel.on("loaddata",function(){this.userPanel.initSelected(this.selectedValue.array)},this);this.userPanel.on("select",function(a){this.selectedValue.clear();this.selectedValue.add(a)},this);this.userPanel.on("deselect",function(a){this.selectedValue.remove(a)},this);this.on("show",function(){this.userPanel.initSelected(this.selectedValue.array)},this);Ext.part.form.userselection.SingelUserSelectWindow.superclass.initComponent.call(this)},submit_onclick:function(a,b){if(this.selectedValue.array.length<1){Ext.parf.showInfo("当前选择的值为空！");return}this.fireEvent("submit",this.selectedValue,b);this.hide()},cancle_onclick:function(a,b){this.hide()},setSelectedValue:function(a){this.selectedValue=a}});Ext.part.form.userselection.SingleUserField=Ext.extend(Ext.form.TwinTriggerField,{trigger1Class:"x-form-search-trigger",trigger2Class:"x-form-clear-trigger",allowBlank:false,hiddenName:"",userWin:null,initComponent:function(){this.hiddenName=this.name;this.name=null;Ext.part.form.userselection.SingleUserField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"选择",cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"清空",cls:"x-form-trigger "+this.trigger2Class}]};this.addEvents("changevalue")},onRender:function(b,a){Ext.part.form.userselection.SingleUserField.superclass.onRender.call(this,b,a);this.hiddenField=new Ext.form.Hidden({renderTo:this.wrap,name:this.hiddenName});this.el.dom.readOnly=true},getName:function(){return this.rendered&&this.hiddenName?this.hiddenName:this.name||this.id||""},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.addClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this);this.trigger.setDisplayed(false)}else{if(!this.editable){this.el.addClass("x-trigger-noedit");this.mon(this.el,"click",this.onTriggerClick,this)}else{this.el.removeClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this)}this.trigger.setDisplayed(!this.hideTrigger)}this.onResize(this.width||this.wrap.getWidth())}},setValue:function(a){if(Ext.isEmpty(a)){a=""}if(Ext.type(a)=="string"){a=new Ext.part.form.userselection.ValueObjArray(a)}this.hiddenField.setValue(a.getHiddenValue());return Ext.part.form.userselection.SingleUserField.superclass.setValue.call(this,a.getDisplayText())},getValue:function(){var a=this.hiddenField.getValue();return new Ext.part.form.userselection.ValueObjArray(a)},onTrigger1Click:function(){if(this.disabled){return}
if(Ext.fjs.module.tabPanel.SingelUserSelectWindow==null){
	Ext.fjs.module.tabPanel.SingelUserSelectWindow=new Ext.part.form.userselection.SingelUserSelectWindow();}
	Ext.fjs.module.tabPanel.SingelUserSelectWindow.on("submit",this.setValueByWindow,this);Ext.fjs.module.tabPanel.SingelUserSelectWindow.on("hide",this.env_windowhide,this);Ext.fjs.module.tabPanel.SingelUserSelectWindow.setSelectedValue(this.getValue());Ext.fjs.module.tabPanel.SingelUserSelectWindow.show()},setValueByWindow:function(a,b){this.fireEvent("changevalue",a);this.setValue(a);Ext.fjs.module.tabPanel.SingelUserSelectWindow.removeListener("submit",this.setValueByWindow,this)},env_windowhide:function(){Ext.fjs.module.tabPanel.SingelUserSelectWindow.removeListener("submit",this.setValueByWindow,this)},onTrigger2Click:function(){if(this.disabled){return}this.fireEvent("changevalue","");this.setValue("")},beforeDestroy:function(){Ext.destroy(this.hiddenField);Ext.part.form.userselection.SingleUserField.superclass.beforeDestroy.call(this)}});Ext.reg("part-singleuser",Ext.part.form.userselection.SingleUserField);Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.SysDefinePanel=Ext.extend(Ext.part.form.userselection.BaseSelectPanel,{checkGroup:null,dataloaded:false,fireSelect:false,constructor:function(){this.dataloaded=false;this.checkGroup=new Ext.parf.form.CheckboxGroup({columns:3,items:[{boxLabel:"所有用户",inputValue:"1"},{boxLabel:"系统管理员",inputValue:"2"},{boxLabel:"部门领导",inputValue:"3"}],allowBlank:true});Ext.part.form.userselection.SysDefinePanel.superclass.constructor.call(this,{title:"预定义",panelType:"F",cls:"x-panel-mc",style:"padding:10px;",margins:"1 1 1 1",items:[this.checkGroup]})},initComponent:function(){this.checkGroup.on("afterrender",function(){this.fireSelect=true;this.checkGroup.items.each(function(a){a.on("check",function(c,b){if(this.fireSelect){if(b){this.fireEvent("select",this.getValueObj(c))}else{this.fireEvent("deselect",this.getValueObj(c))}}},this)},this)},this);Ext.part.form.userselection.SysDefinePanel.superclass.initComponent.call(this)},initSelected:function(e){this.fireSelect=false;var a=this.checkGroup.items;if(Ext.isEmpty(a)){return}if(a.items){a=a.items}for(var b=0;b<a.length;b++){if(a[b].setValue){a[b].setValue(false)}else{a[b].checked=false}for(var c=0;c<e.length;c++){var d=e[c];if(d.type!="F"){continue}if(a[b].inputValue==d.value){if(a[b].setValue){a[b].setValue(true)}else{a[b].checked=true}break}}}this.fireSelect=true},getValueObj:function(a){var b=new Ext.part.form.userselection.ValueObj();b.text=a.boxLabel;b.value=a.inputValue;b.type="F";return b}});Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.MultiUserSelectWindow=Ext.extend(Ext.part.form.userselection.BaseSelectWindow,{userPanel:null,selectedPanel:null,selectedValue:null,constructor:function(){this.userPanel=new Ext.part.form.userselection.UserPanel({single:false});this.selectedPanel=new Ext.part.form.userselection.SelectedPanel();Ext.part.form.userselection.MultiUserSelectWindow.superclass.constructor.call(this,{title:"人员选择",layout:"fit",width:750,height:400,buttonAlign:"center",closeAction:"hide",plain:true,modal:true,resizable:false,items:[{layout:"border",border:false,items:[this.userPanel,this.selectedPanel]}],buttons:[{text:"确定",iconCls:"btn-accept",handler:this.submit_onclick,scope:this},{text:"取消",iconCls:"btn-stop",handler:this.cancle_onclick,scope:this}]})},initComponent:function(){this.userPanel.on("loaddata",function(){this.userPanel.initSelected(this.selectedValue.array)},this);this.userPanel.on("select",function(a){this.selectedValue.add(a);this.selectedPanel.init(this.selectedValue.array)},this);this.userPanel.on("deselect",function(a){this.selectedValue.remove(a);this.selectedPanel.init(this.selectedValue.array)},this);this.on("show",function(){this.selectedPanel.init(this.selectedValue.array);this.userPanel.initSelected(this.selectedValue.array)},this);this.selectedPanel.on("remove",function(b){for(var a=0;a<b.length;a++){this.selectedValue.remove(b[a])}this.selectedPanel.init(this.selectedValue.array);this.userPanel.initSelected(this.selectedValue.array)},this);Ext.part.form.userselection.MultiUserSelectWindow.superclass.initComponent.call(this)},submit_onclick:function(a,b){if(this.selectedValue.array.length<1){Ext.parf.showInfo("当前选择的值为空！");return}this.fireEvent("submit",this.selectedValue,b);this.hide()},cancle_onclick:function(a,b){this.hide()},setSelectedValue:function(a){this.selectedValue=a}});Ext.part.form.userselection.MultiUserField=Ext.extend(Ext.form.TwinTriggerField,{trigger1Class:"x-form-search-trigger",trigger2Class:"x-form-clear-trigger",allowBlank:false,userWin:null,hiddenName:"",height:100,initComponent:function(){this.defaultAutoCreate={tag:"textarea",style:"height:"+this.height+"px;",autocomplete:"off"};this.hiddenName=this.name;this.name=null;Ext.part.form.userselection.MultiUserField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"选择",cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"清空",cls:"x-form-trigger "+this.trigger2Class}]};this.addEvents("changevalue")},onRender:function(b,a){Ext.part.form.userselection.MultiUserField.superclass.onRender.call(this,b,a);this.hiddenField=new Ext.form.Hidden({renderTo:this.wrap,name:this.hiddenName});this.el.dom.readOnly=true},getName:function(){return this.rendered&&this.hiddenName?this.hiddenName:this.name||this.id||""},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.addClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this);this.trigger.setDisplayed(false)}else{if(!this.editable){this.el.addClass("x-trigger-noedit");this.mon(this.el,"click",this.onTriggerClick,this)}else{this.el.removeClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this)}this.trigger.setDisplayed(!this.hideTrigger)}this.onResize(this.width||this.wrap.getWidth())}},setValue:function(a){if(Ext.isEmpty(a)){a=""}if(Ext.type(a)=="string"){a=new Ext.part.form.userselection.ValueObjArray(a)}this.hiddenValue=a;if(this.rendered){Ext.part.form.userselection.MultiUserField.superclass.setValue.call(this,a.getDisplayText());this.hiddenField.setValue(a.getHiddenValue())}},getValue:function(){if(!this.rendered){this.hiddenValue=this.hiddenValue||new Ext.part.form.userselection.ValueObjArray("");return this.hiddenValue}var a=this.hiddenField.getValue();return new Ext.part.form.userselection.ValueObjArray(a)},onTrigger1Click:function(){if(this.disabled){return}if(Ext.fjs.module.tabPanel.MultiUserSelectWindow==null){Ext.fjs.module.tabPanel.MultiUserSelectWindow=new Ext.part.form.userselection.MultiUserSelectWindow()}Ext.fjs.module.tabPanel.MultiUserSelectWindow.on("submit",this.setValueByWindow,this);Ext.fjs.module.tabPanel.MultiUserSelectWindow.on("hide",this.env_windowhide,this);Ext.fjs.module.tabPanel.MultiUserSelectWindow.setSelectedValue(this.getValue());Ext.fjs.module.tabPanel.MultiUserSelectWindow.show()},setValueByWindow:function(a,b){this.setValue(a);this.fireEvent("changevalue",a);Ext.fjs.module.tabPanel.MultiUserSelectWindow.removeListener("submit",this.setValueByWindow,this)},env_windowhide:function(){Ext.fjs.module.tabPanel.MultiUserSelectWindow.removeListener("submit",this.setValueByWindow,this)},onTrigger2Click:function(){if(this.disabled){return}this.setValue("");this.fireEvent("changevalue","")},beforeDestroy:function(){Ext.destroy(this.hiddenField);Ext.part.form.userselection.MultiUserField.superclass.beforeDestroy.call(this)},afterRender:function(){Ext.part.form.userselection.MultiUserField.superclass.afterRender.call(this);if(this.hiddenValue!==undefined){this.setValue(this.hiddenValue)}else{if(!Ext.isEmpty(this.hiddenField.el.dom.value)){this.setValue(this.hiddenField.el.dom.value)}}this.originalValue=this.getValue()},pushUser:function(a){if(Ext.isEmpty(a)){return}if(Ext.type(a)=="string"){a=new Ext.part.form.userselection.ValueObjArray(a)}var c=this.getValue();for(var b=0;b<a.array.length;b++){c.add(a.array[b])}this.setValue(c)},removeUser:function(a){if(Ext.isEmpty(a)){return}if(Ext.type(a)=="string"){a=new Ext.part.form.userselection.ValueObjArray(a)}var c=this.getValue();for(var b=0;b<a.array.length;b++){c.remove(a.array[b])}this.setValue(c)}});Ext.reg("part-multiuser",Ext.part.form.userselection.MultiUserField);Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.PermissionSelectWindow=Ext.extend(Ext.part.form.userselection.BaseSelectWindow,{selectedPanel:null,selectedValue:null,selectPanel:null,constructor:function(){var a=[];a.push(new Ext.part.form.userselection.UserPanel({title:"用户",style:"padding-left:1px;padding-top:1px"}));if("W5"==Ext.part.SysParameter.SYSTEM_EDITION){a.push(new Ext.part.form.userselection.WorkGroupPanel())}a.push(new Ext.part.form.userselection.JobTitlePanel());a.push(new Ext.part.form.userselection.DeptPanel());a.push(new Ext.part.form.userselection.OrgPanel());a.push(new Ext.part.form.userselection.SysDefinePanel());a.push(new Ext.part.form.userselection.RelationPanel());this.selectPanel=new Ext.TabPanel({region:"center",activeTab:0,margins:"0 0 1 0",items:a});this.selectedPanel=new Ext.part.form.userselection.SelectedPanel();Ext.part.form.userselection.PermissionSelectWindow.superclass.constructor.call(this,{title:"选择",layout:"fit",height:400,width:750,buttonAlign:"center",closeAction:"hide",plain:true,modal:true,resizable:false,items:[{layout:"border",border:false,items:[this.selectPanel,this.selectedPanel]}],buttons:[{text:"确定",iconCls:"btn-accept",handler:this.submit_onclick,scope:this},{text:"取消",iconCls:"btn-stop",handler:this.cancle_onclick,scope:this}]})},initComponent:function(){this.on("show",function(){this.initTab();this.selectedPanel.init(this.selectedValue.array);this.selectPanel.getActiveTab().show()},this);this.selectPanel.items.each(function(a){a.on("show",function(b){b.initSelected(this.selectedValue.array)},this);a.on("loaddata",function(b){b.initSelected(this.selectedValue.array)},this);a.on("select",function(b){this.selectedValue.add(b);this.selectedPanel.init(this.selectedValue.array)},this);a.on("deselect",function(b){this.selectedValue.remove(b);this.selectedPanel.init(this.selectedValue.array)},this)},this);this.selectedPanel.on("remove",function(b){for(var a=0;a<b.length;a++){this.selectedValue.remove(b[a])}this.selectedPanel.init(this.selectedValue.array);this.selectPanel.getActiveTab().initSelected(this.selectedValue.array)},this);Ext.part.form.userselection.PermissionSelectWindow.superclass.initComponent.call(this)},setTabConf:function(a){this.tabConf=a},initTab:function(){var a=null;this.selectPanel.items.each(function(d,b,c){if(this.tabConf.indexOf(d.panelType)>-1){if(a==null){a=d}if(d.HIDDEN){this.selectPanel.unhideTabStripItem(d);d.HIDDEN=false}}else{if(!d.HIDDEN){this.selectPanel.hideTabStripItem(d)}d.HIDDEN=true}},this);this.selectPanel.setActiveTab(a)},submit_onclick:function(a,b){if(this.selectedValue.array.length<1){Ext.parf.showInfo("当前选择的值为空！");return}this.fireEvent("submit",this.selectedValue,b);this.hide()},cancle_onclick:function(a,b){this.hide()},setSelectedValue:function(a){this.selectedValue=a}});Ext.part.form.userselection.PermissionField=Ext.extend(Ext.form.TwinTriggerField,{trigger1Class:"x-form-search-trigger",trigger2Class:"x-form-clear-trigger",allowBlank:false,userWin:null,hiddenName:"",height:100,tabConf:"U|W|J|D|O|F|RE",initComponent:function(){this.defaultAutoCreate={tag:"textarea",style:"height:"+this.height+"px;",autocomplete:"off"};this.hiddenName=this.name;this.name=null;Ext.part.form.userselection.PermissionField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"选择",cls:"x-form-trigger "+this.trigger1Class},{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"清空",cls:"x-form-trigger "+this.trigger2Class}]};this.addEvents("changevalue")},onRender:function(b,a){Ext.part.form.userselection.PermissionField.superclass.onRender.call(this,b,a);this.hiddenField=new Ext.form.Hidden({renderTo:this.wrap,name:this.hiddenName});this.el.dom.readOnly=true},getName:function(){return this.rendered&&this.hiddenName?this.hiddenName:this.name||this.id||""},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.addClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this);this.trigger.setDisplayed(false)}else{if(!this.editable){this.el.addClass("x-trigger-noedit");this.mon(this.el,"click",this.onTriggerClick,this)}else{this.el.removeClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this)}this.trigger.setDisplayed(!this.hideTrigger)}this.onResize(this.width||this.wrap.getWidth())}},setValue:function(a){if(Ext.isEmpty(a)){a=""}if(Ext.type(a)=="string"){a=new Ext.part.form.userselection.ValueObjArray(a)}Ext.part.form.userselection.PermissionField.superclass.setValue.call(this,a.getDisplayText());this.hiddenField.setValue(a.getHiddenValue())},getValue:function(){var a=this.hiddenField.getValue();return new Ext.part.form.userselection.ValueObjArray(a)},onTrigger1Click:function(){if(this.disabled){return}if(Ext.fjs.module.tabPanel.PermissionSelectWindow==null){Ext.fjs.module.tabPanel.PermissionSelectWindow=new Ext.part.form.userselection.PermissionSelectWindow()}Ext.fjs.module.tabPanel.PermissionSelectWindow.setTabConf(this.tabConf);Ext.fjs.module.tabPanel.PermissionSelectWindow.on("submit",this.setValueByWindow,this);Ext.fjs.module.tabPanel.PermissionSelectWindow.on("hide",this.env_windowhide,this);Ext.fjs.module.tabPanel.PermissionSelectWindow.setSelectedValue(this.getValue());Ext.fjs.module.tabPanel.PermissionSelectWindow.show()},setValueByWindow:function(a,b){this.fireEvent("changevalue",a);this.setValue(a);Ext.fjs.module.tabPanel.PermissionSelectWindow.removeListener("submit",this.setValueByWindow,this)},env_windowhide:function(){Ext.fjs.module.tabPanel.PermissionSelectWindow.removeListener("submit",this.setValueByWindow,this)},onTrigger2Click:function(){if(this.disabled){return}this.fireEvent("changevalue","");this.setValue("")},beforeDestroy:function(){Ext.destroy(this.hiddenField);Ext.part.form.userselection.PermissionField.superclass.beforeDestroy.call(this)}});Ext.reg("part-permission",Ext.part.form.userselection.PermissionField);Ext.namespace("Ext.part.form.userselection");Ext.part.form.userselection.DisplayUserField=Ext.extend(Ext.form.DisplayField,{setValue:function(a){if(Ext.isEmpty(a)){a=""}else{a=new Ext.part.form.userselection.ValueObjArray(a).getDisplayText()}a=a.replace(/;/g,",&nbsp;&nbsp;");Ext.part.form.userselection.DisplayUserField.superclass.setValue.call(this,a)}});Ext.reg("part-display-userfield",Ext.part.form.userselection.DisplayUserField);

Ext.part.form.userselection.SingleUserField.override(
{
	getValue : function()
	{
		var v = this.hiddenField ? this.hiddenField.getValue() : "";
		return new Ext.part.form.userselection.ValueObjArray(v);
	}
});

Ext.namespace('Ext.part.form.userselection');

Ext.part.form.userselection.DisplayUserField = Ext.extend(Ext.form.DisplayField,
{  
	//private
	setValue:function(v)
	{
		if(Ext.isEmpty(v))
		{	
			v = '';
		}
		else if(Ext.isString(v))
		{
			v = new Ext.part.form.userselection.ValueObjArray(v).getDisplayText();
		}
		else if(v.getDisplayText)
		{
			v = v.getDisplayText();
		}
		v = v.replace( /;/g ,',&nbsp;&nbsp;');
		Ext.part.form.userselection.DisplayUserField.superclass.setValue.call(this, v);
	}
});
Ext.reg('part-display-userfield', Ext.part.form.userselection.DisplayUserField);
