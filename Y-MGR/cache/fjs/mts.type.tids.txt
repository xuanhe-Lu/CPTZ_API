Ext.namespace('Ext.mts.type.tids');Ext.mts.type.tids.g_url='mts/type_tids.do';Ext.mts.type.tids.addWindow=Ext.extend(Ext.Window,{constructor:function(tree){this.tree=tree;this.form=new Ext.FormPanel({cls:"x-panel-mc",layout:"html",layoutConfig:{css:"fjs-form",template:"mts/type_tids.tpl"},style:"padding:0px",items:[{xtype:"displayfield",name:"TID",width:100},{xtype:"textfield",name:"NAME",width:280,allowBlank:false,boldLabel:true,minLength:1,maxLength:50},{xtype:"fjs-store-combo",hiddenName:"STATE",name:"STATE",width:100,allowBlank:false,allrec:false,dictId:"system.state"}]});Ext.mts.type.tids.addWindow.superclass.constructor.call(this,{iconCls:"btn-add",title:"mter.title.tids",width:400,autoHeight:true,border:false,closeAction:"hide",modal:true,plain:true,resizable:false,items:[this.form],buttonAlign:"center",buttons:[{iconCls:"btn-accept1",text:"确定",handler:this.window_submit,scope:this},{iconCls:"btn-stop1",text:"取消",handler:this.window_close,scope:this}]})},window_close:function(){this.hide()},window_submit:function(){if(Ext.fjs.checkValid(this.form)){this.form.getForm().submit(Ext.fjs.saveAction({url:Ext.mts.type.tids.g_url,params:{action:"save",sid:this.node.id},success:this.apply_success,scope:this}))}},apply_success:function(form,opts){var n=this.node;if(n.isLeaf()){n.parentNode.reload()}else{n.reload()};this.form.getForm().reset();this.window_close()},load:function(id){var s=this.tree;this.node=s.getSelectionModel().getSelectedNode()||s.root;this.form.getForm().setValues({TID:this.node.id});this.show(id)}});Ext.mts.type.tids.modWindow=Ext.extend(Ext.Window,{constructor:function(tree){this.tree=tree;this.form=new Ext.FormPanel({cls:"x-panel-mc",layout:"html",layoutConfig:{css:"fjs-form",template:"mts/type_tids.tpl"},style:"padding:0px",items:[{xtype:"displayfield",name:"TID",width:100},{xtype:"textfield",name:"NAME",width:280,allowBlank:false,boldLabel:true,minLength:1,maxLength:50},{xtype:"fjs-store-combo",hiddenName:"STATE",name:"STATE",width:100,allowBlank:false,allrec:false,dictId:"system.state"}]});Ext.mts.type.tids.addWindow.superclass.constructor.call(this,{iconCls:"btn-eidt",title:"mter.title.tids",width:400,autoHeight:true,border:false,closeAction:"hide",modal:true,plain:true,resizable:false,items:[this.form],buttonAlign:"center",buttons:[{iconCls:"btn-accept1",text:"确定",handler:this.window_submit,scope:this},{iconCls:"btn-stop1",text:"取消",handler:this.window_close,scope:this}]})},window_close:function(){this.hide()},window_submit:function(){if(Ext.fjs.checkValid(this.form)){this.form.getForm().submit(Ext.fjs.saveAction({url:Ext.mts.type.tids.g_url,params:{action:"save",tid:this.node.id},success:this.apply_success,scope:this}))}},apply_success:function(form,opts){this.form.getForm().reset();this.node.parentNode.reload();this.window_close()},load:function(id){var s=this.tree;this.node=s.getSelectionModel().getSelectedNode();this.form.getForm().load(Ext.fjs.loadAction({url:Ext.mts.type.tids.g_url,params:{action:"getInfo",tid:this.node.id},show:true,scope:this}))}});Ext.mts.type.tids.MainPanel=Ext.extend(Ext.tree.TreePanel,{constructor:function(grid){this.grid=grid;this.refBtn=new Ext.Button({iconCls:"btn-refresh",text:"刷新",tooltip:"刷新",handler:this.refresh_onclick,scope:this});this.exdBtn=new Ext.Button({iconCls:"btn-expand",text:"展开",tooltip:"展开",handler:this.expandAll,scope:this});this.collBtn=new Ext.Button({iconCls:"btn-collapse",text:"收起",tooltip:"收起",handler:this.collapseAll,scope:this});this.addBtn=new Ext.Button({iconCls:"btn-add",text:"新增",tooltip:"增加",handler:this.add_onclick,scope:this});this.modBtn=new Ext.Button({iconCls:"btn-edit",text:"修改",tooltip:"修改",disabled:true,handler:this.mod_onclick,scope:this});this.delBtn=new Ext.Button({iconCls:"btn-delete",text:"删除",tooltip:"删除",disabled:true,handler:this.del_onclick,scope:this});Ext.mts.type.tids.MainPanel.superclass.constructor.call(this,{animate:true,animCollapse:false,autoScroll:true,border:false,closable:true,useArrows:true,rootVisible:false,root:{id:"0",type:"root",nodeType:"async"},loader:new Ext.tree.TreeLoader({url:Ext.mts.type.tids.g_url,baseParams:{action:"getChildrens"}}),tbar:[this.refBtn,"-",this.exdBtn,"-",this.collBtn,"-",this.addBtn,"-",this.modBtn,"-",this.delBtn]});this.on("click",this.evt_click,this);this.on("contextmenu",this.show_contextmenu,this)},evt_click:function(node){this.modBtn.enable();this.delBtn.enable()},refresh_onclick:function(){this.modBtn.disable();this.delBtn.disable();this.getSelectionModel().clearSelections();this.root.reload()},add_onclick:function(btn){var w=this.addWin;if(!w){this.addWin=w=new Ext.mts.type.tids.addWindow(this)};w.load(btn.id)},mod_onclick:function(btn){var w=this.modWin;if(!w){this.modWin=w=new Ext.mts.type.tids.modWindow(this)};w.load(btn.id)},del_onclick:function(){Ext.msg.confirm(Ext.fjs.NOTICE,Ext.fjs.del_confirm,this.delConfirm,this)},delConfirm:function(btn){if(btn=="yes"){var node=this.getSelectionModel().getSelectedNode();Ext.fjs.post({url:Ext.mts.type.tids.g_url,params:{action:"delete",tid:node.id},success:this.del_success,scope:this})}},del_success:function(res,opts){var rs=Ext.decode(res.responseText);if(rs.success){var node=this.getSelectionModel().getSelectedNode().parentNode;if(node.parentNode){node.parentNode.reload()}else{this.root.reload()}}else{Ext.fjs.showError(rs.message)}},beforeDestroy:function(){if(this.provWin)Ext.destroy(this.provWin);Ext.mts.type.tids.MainPanel.superclass.beforeDestroy.call(this)}});