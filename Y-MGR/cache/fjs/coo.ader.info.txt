Ext.namespace("Ext.coo.ader.info");Ext.coo.ader.info.g_url="coo/ader_info.do";Ext.coo.ader.info.exportWindow=Ext.extend(Ext.Window,{params:{},constructor:function(){this.form=new Ext.FormPanel({cls:"x-panel-mc",autoHeight:true,border:false,bodyStyle:"padding:5px;",labelWidth:65,items:[{xtype:"fjs-store-radio",name:"Suffix",fieldLabel:"文件类型",dictId:"system.export.excel",groupcfg:{name:"Suffix"}}]});Ext.coo.ader.info.exportWindow.superclass.constructor.call(this,{iconCls:"btn-excel",title:"Excel 格式",width:320,autoHeight:true,border:false,closable:true,closeAction:"hide",modal:true,plain:true,resizable:false,items:[this.form],buttonAlign:"center",buttons:[{iconCls:"btn-accept1",text:"提交",handler:this.window_submit,scope:this},{iconCls:"btn-stop1",text:"取消",handler:this.window_close,scope:this}]})},window_close:function(){this.hide()},window_submit:function(){this.params.action="export";this.form.getForm().submit(Ext.fjs.loadAction({url:Ext.coo.ader.info.g_url,params:this.params,success:this.apply_success,scope:this}))},apply_success:function(form,opts){Ext.fjs.download("/down.php?filename="+opts.result.message);this.window_close()}});Ext.coo.ader.info.orderWindow=Ext.extend(Ext.Window,{constructor:function(grid){this.grid=grid;this.store=new Ext.data.Store({autoDestroy:true,url:Ext.coo.ader.info.g_url,baseParams:{action:"tree"},reader:new Ext.data.JsonReader({root:"",fields:["id","text"]})});this.form=new Ext.form.FormPanel({frame:true,layout:"column",labelAlign:"left",labelWidth:85,width:255,height:222,style:"padding-right:1.8px;padding-bottom:1.8px",items:[{xtype:"fjs-itemorder",name:"Ids",multiselects:{width:250,height:216,allowBlank:false,ddReorder:true,store:this.store,displayField:"text",valueField:"id"}}]});Ext.coo.ader.info.orderWindow.superclass.constructor.call(this,{iconCls:"btn-order",title:"排序设置",layout:"fit",width:300,height:300,closeAction:"hide",modal:true,plain:true,resizable:false,items:this.form,buttonAlign:"center",buttons:[{iconCls:"btn-accept1",text:"提交",handler:this.window_submit,scope:this},{iconCls:"btn-stop1",text:"取消",handler:this.window_close,scope:this}]})},window_close:function(){this.form.getForm().reset();this.hide()},window_submit:function(){if(Ext.fjs.checkValid(this.form)){this.form.getForm().submit(Ext.fjs.saveAction({url:Ext.coo.ader.info.g_url,params:{action:"order"},success:this.apply_success,scope:this}))}},apply_success:function(from,opts){this.window_close();this.grid.refresh()},open:function(btn,tid){(function(){this.store.load({params:{tid:tid}})}).defer(100,this);this.show(btn.id)}});Ext.coo.ader.info.addWindow=Ext.extend(Ext.Window,{constructor:function(grid){this.grid=grid;this.form=new Ext.form.FormPanel({cls:"x-panel-mc",fileUpload:true,layout:"html",layoutConfig:{css:"fjs-form",template:"coo/ads_form.tpl"},style:"padding-top:0px",items:[{xtype:"textfield",fieldLabel:"name",name:'NAME',width:250,allowBlank:false,boldLabel:true,maxLength:50},{xtype:"textfield",fieldLabel:"tags",name:"TAGS",width:250,allowBlank:true,boldLabel:true,maxLength:100},{xtype:"textfield",fieldLabel:"url",name:"URL",width:250,allowBlank:true,boldLabel:true,maxLength:200},{xtype:"fileuploadfield",fieldLabel:"file",name:"files",width:250,emptyText:"选择文件路径",allowBlank:true,anchor:"95%",buttonText:"选择文件"},{xtype:"fjs-store-combo",hiddenName:"TID",name:"TID",width:250,allowBlank:false,allrec:false,dictId:"coo.ader.tids"},{xtype:"fjs-store-combo",hiddenName:"TYPE",name:"TYPE",width:100,allowBlank:true,allrec:false,dictId:"coo.ader.type"},{xtype:"fjs-store-combo",hiddenName:"STATE",name:"STATE",width:100,allowBlank:true,allrec:false,dictId:"system.state"}]});Ext.coo.ader.info.addWindow.superclass.constructor.call(this,{iconCls:"btn-add",title:"信息编辑",width:450,autoHeight:true,autoScroll:true,border:false,closable:true,closeAction:"hide",modal:true,plain:true,resizable:false,items:[this.form],buttonAlign:"center",buttons:[{iconCls:"btn-save",text:"提交",handler:this.window_submit,scope:this},{iconCls:"btn-stop1",text:"取消",handler:this.window_close,scope:this}]})},window_close:function(){this.hide()},window_submit:function(){if(Ext.fjs.checkValid(this.form)){var fv=this.form.getForm().findField("files").getValue();if(/(jpg|jpeg|png|bmp)$/i.test(fv)){this.form.getForm().submit(Ext.fjs.saveAction({url:Ext.coo.ader.info.g_url,params:{action:"save"},success:this.apply_success,scope:this}))}else{Ext.fjs.showInfo("请选择后缀是jpg,jpeg,png,bmp的图片文件！")}}},apply_success:function(form,opts){this.form.getForm().reset();this.grid.refresh();this.window_close()}});Ext.coo.ader.info.modWindow=Ext.extend(Ext.Window,{constructor:function(grid){this.grid=grid;this.form=new Ext.form.FormPanel({cls:"x-panel-mc",fileUpload:true,layout:"html",layoutConfig:{css:"fjs-form",template:"coo/ads_info.tpl"},style:"padding-top:0px",items:[{xtype:"textfield",fieldLabel:"name",name:'NAME',width:250,allowBlank:false,boldLabel:true,maxLength:50},{xtype:"textfield",fieldLabel:"tags",name:"TAGS",width:250,allowBlank:true,boldLabel:true,maxLength:100},{xtype:"textfield",fieldLabel:"url",name:"URL",width:250,allowBlank:true,boldLabel:true,maxLength:200},{xtype:"fileuploadfield",fieldLabel:"file",name:"files",width:250,emptyText:"选择文件路径",allowBlank:true,anchor:"95%",buttonText:"选择文件"},{xtype:"fjs-store-combo",hiddenName:"TID",name:"TID",width:250,allowBlank:false,allrec:false,dictId:"coo.ader.tids"},{xtype:"fjs-store-combo",hiddenName:"TYPE",name:"TYPE",width:100,allowBlank:true,allrec:false,dictId:"coo.ader.type"},{xtype:"fjs-store-combo",hiddenName:"STATE",name:"STATE",width:100,allowBlank:true,allrec:false,dictId:"system.state"}]});Ext.coo.ader.info.modWindow.superclass.constructor.call(this,{iconCls:"btn-edit",title:"信息编辑",width:450,autoHeight:true,autoScroll:true,border:false,closable:true,closeAction:"hide",modal:true,plain:true,resizable:false,items:[this.form],buttonAlign:"center",buttons:[{iconCls:"btn-save",text:"提交",handler:this.window_submit,scope:this},{iconCls:"btn-stop1",text:"取消",handler:this.window_close,scope:this}]})},window_close:function(){this.hide()},window_submit:function(){if(Ext.fjs.checkValid(this.form)){var fv=this.form.getForm().findField("files").getValue();if(fv==""||/(jpg|jpeg|png|bmp)$/i.test(fv)){this.form.getForm().submit(Ext.fjs.saveAction({url:Ext.coo.ader.info.g_url,params:{action:"save",sid:this.sid},success:this.apply_success,scope:this}))}else{Ext.fjs.showInfo("请选择后缀是jpg,jpeg,png,bmp的图片文件！")}}},apply_success:function(form,opts){this.form.getForm().reset();this.grid.refresh();this.window_close()},loader_success:function(res,opts){var rs=opts.result.data;this.show();Ext.fjs.image("ads_info",rs.SID.toLowerCase(),rs.DIST,rs.VER)},open:function(sid){this.sid=sid;this.form.getForm().load(Ext.fjs.loadAction({url:Ext.coo.ader.info.g_url,params:{action:"getInfo",sid:sid},success:this.loader_success,scope:this}))}});Ext.coo.ader.info.ListBar=Ext.extend(Ext.grid.GridPanel,{constructor:function(){this.code=0;this.store=new Ext.fjs.PageStore({url:Ext.coo.ader.info.g_url,baseParams:{action:"list"},fields:["SID","TID","SORTID","NAME","TAGS","TYPE","URL","STATE","TIME"]});this.store.load({params:{start:0,limit:Ext.fjs.defPSize}});var sm=new Ext.grid.CheckboxSelectionModel();var cm=new Ext.grid.ColumnModel([sm,new Ext.grid.RowNumber()<s:header id="coo.ader.info"/>]);this.addBtn=new Ext.Button({iconCls:"btn-add",text:"增加",tooltip:"增加",handler:this.add_onclick,scope:this});this.modBtn=new Ext.Button({iconCls:"btn-edit",text:"修改",tooltip:"请选择一行",disabled:true,handler:this.mod_onclick,scope:this});this.disBtn=new Ext.Button({iconCls:"btn-stop1",text:"停用",tooltip:"停用",disabled:true,handler:this.dis_onclick,scope:this});this.delBtn=new Ext.Button({iconCls:"btn-delete",text:"删除",tooltip:"请选择一行",disabled:true,handler:this.del_onclick,scope:this});this.ordBtn=new Ext.Button({iconCls:"btn-order",text:"排序",tooltip:"排序",disabled:false,handler:this.order_onclick,scope:this});this.extBtn=new Ext.Button({iconCls:"btn-excel",text:"导出",tooltip:"导出",disabled:false,handler:this.export_onclick,scope:this});Ext.coo.ader.info.ListBar.superclass.constructor.call(this,{region:"center",store:this.store,stripeRows:true,autoScroll:true,boldHeader:true,border:false,closable:true,columnLines:true,containerScroll:true,loadMask:true,cm:cm,sm:sm,style:"border-left:1px solid #8db2e3;",tbar:[{xtype:"label",boldLabel:true,text:"查询:"},this.fkey=new Ext.form.TextField({xtype:"textfield",name:"fkey",width:100,maxLength:50}),{xtype:"tbspacer",width:5},{iconCls:"btn-search",tooltip:"查询",handler:this.search_onclick,scope:this},"->",this.addBtn,"-",this.modBtn,"-",this.disBtn,"-",this.delBtn,"-",this.ordBtn,"-",this.extBtn],bbar:Ext.fjs.PageToolBar({store:this.store})});this.on("rowdblclick",this.mod_onclick,this);this.getSelectionModel().on("selectionchange",this.evt_selection,this)},evt_selection:function(sm){var len=sm.getCount();if(len==1){this.modBtn.enable()}else{this.modBtn.disable()};if(len>=1){this.disBtn.enable();this.delBtn.enable()}else{this.disBtn.disable();this.delBtn.disable()}},refresh:function(){this.getBottomToolbar().doRefresh()},reload:function(tid){if(this.tid==tid){}else{this.tid=tid;this.store.setBaseParam("Tid",tid);this.store.load({params:{start:0,limit:this.getBottomToolbar().pageSize}})}},search_onclick:function(){var s=this.store;s.setBaseParam("KEY",this.fkey.getValue());s.load({params:{start:0,limit:this.getBottomToolbar().pageSize}})},getSid:function(){return Ext.fjs.getPKId(this,"SID")},add_onclick:function(btn){var w=this.addWin;if(!w){this.addWin=w=new Ext.coo.ader.info.addWindow(this)};w.show(btn.id)},mod_onclick:function(btn){var w=this.modWin;if(!w){this.modWin=w=new Ext.coo.ader.info.modWindow(this)};w.open(this.getSid())},dis_onclick:function(btn){Ext.fjs.post({url:Ext.coo.ader.info.g_url,params:{action:"disable",ids:this.getSid()},success:this.apply_success,scope:this})},del_onclick:function(){Ext.msg.confirm(Ext.fjs.NOTICE,Ext.fjs.del_confirm,this.delConfirm,this)},delConfirm:function(btn){if(btn=="yes"){Ext.fjs.post({url:Ext.coo.ader.info.g_url,params:{action:"delete",ids:this.getSid()},success:this.apply_success,scope:this})}},order_onclick:function(btn){var w=this.ordWin;if(!w){this.ordWin=w=new Ext.coo.ader.info.orderWindow(this)};w.open(btn,this.tid)},apply_success:function(res,opts){var rs=Ext.decode(res.responseText);if(rs.success){this.refresh()}else{Ext.fjs.showError(rs.message)}},export_onclick:function(btn){var w=this.extWin;if(!w){this.extWin=w=new Ext.coo.ader.info.exportWindow()};w.params.Tid=this.tidw.params.Key=this.fkey.getValue();w.show(btn.id)},beforeDestroy:function(){if(this.addWin)Ext.destroy(this.addWin);if(this.modWin)Ext.destroy(this.modWin);if(this.ordWin)Ext.destroy(this.ordWin);if(this.extWin)Ext.destroy(this.extWin);Ext.coo.ader.info.ListBar.superclass.beforeDestroy.call(this)}});Ext.coo.ader.info.TreeBar=Ext.extend(Ext.tree.TreePanel,{constructor:function(grid){this.grid=grid;Ext.coo.ader.info.TreeBar.superclass.constructor.call(this,{region:"west",width:200,minSize:200,maxSize:300,animate:true,animCollapse:false,autoScroll:true,border:false,collapseFirst:false,collapseMode:"mini",collapsible:false,enableDD:false,split:true,style:"border-right:1px solid #8db2e3;",useArrows:true,rootVisible:false,root:{id:"0",text:"区域信息",nodeType:"async",expanded:true},loader:new Ext.tree.TreeLoader(),tbar:[{iconCls:"btn-refresh",text:"刷新",tooltip:"刷新",handler:this.refresh_onclick,scope:this},"-",{iconCls:"btn-collapse",text:"收起",tooltip:"收起",handler:this.collapseAll,scope:this}]});this.on("beforeload",this.evt_beforeload,this);this.on("click",this.evt_click,this);this.on("contextmenu",this.show_contextmenu,this)},evt_beforeload:function(n){var v=this.loader;v.dataUrl="/dic.do";v.baseParams.sid="coo.ader.tids"},evt_click:function(node){this.grid.reload(node.id);if(node.isLeaf()){}else if(node.isExpanded()){node.collapse()}else{node.expand()}},refresh_onclick:function(){this.getSelectionModel().clearSelections();this.root.reload()}});Ext.coo.ader.info.MainPanel=Ext.extend(Ext.Panel,{constructor:function(){this.list=new Ext.coo.ader.info.ListBar();this.tree=new Ext.coo.ader.info.TreeBar(this.list);Ext.coo.ader.info.MainPanel.superclass.constructor.call(this,{closable:true,layout:"border",items:[this.tree,this.list]})},beforeDestroy:function(){Ext.destroy(this.list);Ext.destroy(this.tree);Ext.coo.ader.info.MainPanel.superclass.beforeDestroy.call(this)}});